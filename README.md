
# Автоматизация сборки и деплоя Python Docker-приложений через Jenkins с интеграцией GitHub
***

## Введение

Цель данной лабораторной работы — освоить практические навыки автоматизации процесса непрерывной интеграции и развертывания (CI/CD) с использованием Jenkins — мощного инструмента автоматизации сборки, а также наладить взаимодействие с удалённым репозиторием GitHub посредством webhook, обеспечивающим мгновенный запуск сборки при каждом изменении кода.

В рамках работы создадим собственный Jenkins job, используя готовый Pipeline скрипт (Jenkinsfile), освоим управление параметрами сборки, настройку вебхуков для инициирования автоматических сборок, запустим тесты в изолированном Docker-контейнере и развернем приложение с учётом индивидуальных параметров (порт, имя студента).

***

## Среда выполнения

- Адрес Jenkins-сервера: [http://84.201.147.67:8080/](http://84.201.147.67:8080/)
- GitHub-репозиторий с исходным кодом: выгрузите код из ==ДАННОГО== репозитория в свой и укажите свой URL GitHub при настройке job, например, `https://github.com/yourusername/yourproject.git`
***

## Шаг 1. Создание и конфигурирование Jenkins Job

1. Авторизуйтесь на Jenkins-сервере по указанному IP и порту.
2. В верхнем меню выберите кнопку **New Item** для создания нового проекта.
3. Задайте уникальное имя проекта — рекомендуется использовать формат, содержащий фамилию и имя (например, `student-john-doe`).
4. В списке типов проектов выберите **Pipeline** и нажмите **OK**.
5. В открывшемся окне перейдите к разделу **Pipeline**:
   - В поле **Definition** выберите **Pipeline script**.
   - В поле ниже вставьте заготовленный Pipeline скрипт (Jenkinsfile), предоставленный преподавателем.

6. В Jenkinsfile отдельно отредактируйте параметры:
   - В поле `STUDENT_NAME` укажите своё имя — используется для динамического отображения на развёрнутом сайте.
   - В поле `PORT` укажите уникальный порт, используемый для развертывания приложения. Убедитесь, что порт не пересекается с другими студентами (например, 8081, 8082, …).

7. Сохраните конфигурацию проекта.

***

## Шаг 2. Структура Jenkinsfile и описание этапов

```groovy
pipeline {
    agent any
    
    parameters {
        string(name: 'STUDENT_NAME', defaultValue: 'Student', description: 'Имя студента')
        string(name: 'PORT', defaultValue: '8081', description: 'Порт')
    }
    
    stages {
        stage('Выгружаем код из репозитория') {
            steps {
                git 'https://github.com/xDeshka/hellojenkins.git'
            }
        }
        stage('Собираем docker image') {
            steps {
                script {
                    dockerImage = docker.build("student-fio-app")
                }
            }
        }
        stage('Запускаем тесты в докере') {
            steps {
                script {
                    dockerImage.inside {
                        sh 'python -m unittest test_app.py'
                    }
                }
            }
        }
        stage('Запускаем докер контейнер') {
            steps {
                script {
                    sh "docker rm -f student-fio-container || true"
                    sh "docker run -d --name hello-student-container -p ${params.PORT}:${params.PORT} -e STUDENT_NAME='${params.STUDENT_NAME}' -e PORT=${params.PORT} student-fio-app"
                }
            }
        }
    }
}
```

### Ключевые моменты:

- **Параметры Pipeline** позволяют задавать индивидуальное имя студента и порт развёртывания, делая pipeline максимально гибким и повторно используемым.
- **Выгрузка кода из GitHub** выполняется через встроенный шаг `git`, что позволяет Jenkins автоматически получать свежие изменения.
- **Сборка Docker-образа** гарантирует, что приложение упаковано в изолированный контейнер, что упрощает переносимость и эксплуатацию.
- **Выполнение тестов внутри контейнера** повышает надёжность кода: сборка не пойдёт дальше при наличии ошибок.
- **Запуск Docker-контейнера с параметрами окружения и пробросом порта** реализует персонализированный деплой с учётом индивидуального порта и отображением имени студента.

***

## Шаг 3. Настройка GitHub webhook для автоматического запуска сборки

1. Перейдите в ваш репозиторий на GitHub.
2. Во вкладке **Settings** выберите пункт **Webhooks**.
3. Нажмите кнопку **Add webhook**.
4. В поле **Payload URL** введите адрес вашего Jenkins вебхука:
   ```
   http://84.201.147.67:8080/github-webhook/
   ```
5. В поле **Content type** выберите `application/json`.
6. В разделе **Which events would you like to trigger this webhook?** выберите **Just the push event**.
7. Подтвердите добавление вебхука.

***

## Шаг 4. Работа с Jenkins и проверка

1. В интерфейсе Jenkins откройте созданную job.
2. Нажмите кнопку **Build Now**, чтобы инициировать первую сборку.
3. Мониторьте процесс исполнения через вкладку **Console Output** — убедитесь, что код корректно выкачан, прошли тесты, приложение собрано и запущено.
4. Откройте приложение в браузере по адресу:
   ```
   http://84.201.147.67:<ваш_порт>/
   ```

   Должно отображаться приветствие с вашим именем.

5. Внесите изменения в репозиторий и выполните коммит в ветку `master`.
6. Убедитесь, что GitHub webhook корректно сработал, и Jenkins автоматически запустил повторную сборку.

***
